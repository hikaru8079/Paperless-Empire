@{
    ViewData["Title"] = "ホーム";
}
model GoogleAccountViewModel

<div class="text-center">
    <h2>ITカレッジ 公欠届提出/管理システム</h2>
    <p>日本工学院八王子専門学校 ITカレッジにおける、主に<mark>就職活動</mark>を目的とした公欠の申請用システムです。</p>
    <p>現状ではPCでのアクセスを想定して開発しています。スマートフォンでアクセスした場合、表示が乱れることがありますのでPCでのアクセスをお願いいたします。</p>
    <p>@Model.Name   @Model.Email</p>
    <pre><code>public ActionResult Index(){
        // Googleアカウントの情報を取得(下のメソッドを走らせる)
        GoogleUserInfo userInfo = GetGoogleUserInfoFromHeaders(Request).Result;
        // ビューモデルを作成し、Googleアカウントの情報を格納
        var viewModel = new GoogleAccountViewModel{
            Name = userInfo.Name,
            Email = userInfo.Email,
        };
        return View(viewModel);
    }

    public async Task<GoogleUserInfo> GetGoogleUserInfoFromHeaders(HttpRequest request){
        var idToken = request.Headers["X-MS-TOKEN-GOOGLE-ID-TOKEN"].FirstOrDefault();
        var accessToken = request.Headers["X-MS-TOKEN-GOOGLE-ACCESS-TOKEN"].FirstOrDefault();
        using (var httpClient = new HttpClient()){
            var endpoint = "https://www.googleapis.com/oauth2/v3/userinfo";
            var userInfoRequest = new HttpRequestMessage(HttpMethod.Get, endpoint);
            userInfoRequest.Headers.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", accessToken);
            var userInfoResponse = await httpClient.SendAsync(userInfoRequest);
            if (userInfoResponse.IsSuccessStatusCode){
                var content = await userInfoResponse.Content.ReadAsStringAsync();
                var userInfo = JsonConvert.DeserializeObject<GoogleUserInfo>(content);
                return userInfo;
            }else{
                throw new Exception("Google API request failed.");
            }
        }
    }
}</code></pre>
    <div class="mb-4">
        <a class="btn btn-outline-dark" asp-controller="Registration" asp-action="Index">申請はこちら</a>
        <a class="btn btn-outline-dark" asp-controller="Report" asp-action="Index">活動報告はこちら</a>
        <a class="btn btn-outline-dark" asp-controller="TeachingStaff" asp-action="Index">教員・講師の方はこちら</a>
        <a class="btn btn-outline-dark" asp-controller="CSCStaff" asp-action="Index">CSC職員の方はこちら</a>
    </div>
</div>